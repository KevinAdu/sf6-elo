---
import './EloCalculator.css';

function formatPercent(prob: number): string {
  return (prob * 100).toFixed(2) + '%';
}

// Generate rating differences to show (every 100 points from -400 to +400)
const ratingOffsets = [];
for (let diff = -400; diff <= 400; diff += 100) {
  ratingOffsets.push(diff);
}
---

<div class="elo-calculator">
  <h3>Elo Rating Calculator</h3>
  
  <form class="elo-form" id="eloForm">
    <label for="elo">Your Elo Rating:</label>
    <input 
      type="number" 
      id="elo" 
      name="elo" 
      value="1500"
      min="600" 
      max="2500" 
      step="1"
      required
    />
    <!-- <label for="elo">Opponent's Elo Rating:</label>
    <input 
      type="number" 
      id="elo" 
      name="elo" 
      value="1500"
      min="600" 
      max="2500" 
      step="1"
      required
    /> -->
  </form>

  <div class="results" id="results" style="display: none;">
    <h4>Win Probabilities for <span id="userEloDisplay">1500</span> Elo</h4>
    <table class="probability-grid" id="probabilityGrid">
      <thead>
        <tr>
          <th class="grid-header">Opponent Rating</th>
          <th class="grid-header">Rating Difference</th>
          <th class="grid-header">Win Probability</th>
        </tr>
    </thead>
    <tbody id="probabilityGridBody"></tbody>
    </table>
  </div>
</div>

<script>
  // Import the helper function
  import { getClosestProbability } from '../utils/eloProbabilities';

  function formatPercent(prob: number): string {
    return (prob * 100).toFixed(2) + '%';
  }

  // Generate rating differences
  const ratingOffsets: number[] = [];
  for (let diff = -400; diff <= 400; diff += 50) {
    ratingOffsets.push(diff);
  }

  document.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('eloForm') as HTMLFormElement;
    const input = document.getElementById('elo') as HTMLInputElement;
    const results = document.getElementById('results') as HTMLDivElement;
    const userEloDisplay = document.getElementById('userEloDisplay') as HTMLSpanElement;
    const probabilityGrid = document.getElementById('probabilityGridBody') as HTMLDivElement;

    function updateResults() {
      const userElo = parseInt(input.value) || 1500;
      userEloDisplay.textContent = userElo.toString();
      
      const existingRows = probabilityGrid.querySelectorAll('.grid-cell');
      existingRows.forEach(row => row.remove());

      
      ratingOffsets.forEach(diff => {
        const opponentRating = userElo + diff;
        const winProbability = getClosestProbability(diff);

        const probabilityGridRow = document.createElement('tr');
        
        const opponentCell = document.createElement('td');
        opponentCell.className = 'grid-cell opponent-rating';
        opponentCell.textContent = opponentRating.toString();
        
        const offsetCell = document.createElement('td');
        offsetCell.className = 'grid-cell rating-diff';
        offsetCell.textContent = diff > 0 ? `+${diff}` : diff.toString();
        
        const probabilityCell = document.createElement('td');
        probabilityCell.className = 'grid-cell win-prob';
        probabilityCell.textContent = formatPercent(winProbability);
        
        probabilityGridRow.appendChild(opponentCell);
        probabilityGridRow.appendChild(offsetCell);
        probabilityGridRow.appendChild(probabilityCell);
        probabilityGrid.appendChild(probabilityGridRow);
      });

      results.style.display = 'block';
    }

    input.addEventListener('input', updateResults);
    updateResults();
  });
</script> 